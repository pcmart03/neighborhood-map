var model={keyPlaces:[{name:"Jaleo",phone:7034138181,lat:38.853636,lng:-77.049553,highlight:ko.observable(null)},{name:"Extreme Pizza",phone:7032711020,lat:38.860028,lng:-77.056056,highlight:ko.observable(null)},{name:"RedRocks Neapolitan Bistro",phone:7039200706,lat:38.864033,lng:-77.084282,highlight:ko.observable(null)},{name:"Giant",phone:7033589343,lat:38.885886,lng:-77.103031,highlight:ko.observable(null)},{name:"El Paso Cafe",phone:7032439811,lat:38.873588,lng:-77.106285,highlight:ko.observable(null)},{name:"El Pollo Rico",phone:7035223220,lat:38.88383,lng:-77.10683,highlight:ko.observable(null)},{name:"9:30",phone:2022650930,lat:38.918062,lng:-77.02372,highlight:ko.observable(null)},{name:"Ristorante La Perla of Washington",phone:2023331767,lat:38.904063,lng:-77.055062,highlight:ko.observable(null)},{name:"Fahrney's Pens Inc",phone:2026289525,lat:38.89753,lng:-77.03031,highlight:ko.observable(null)}]},viewModel=function(){var e,o,a=this,r=model.keyPlaces;a.yelpObjects=ko.observableArray(),a.markers=ko.observableArray(),a.searchTerm=ko.observable(""),a.selectedMarker=ko.observable(),a.previousMarker=ko.observable(a.markers()[0]),a.filteredMarkers=ko.computed(function(){var e=a.searchTerm().toLowerCase();return e?ko.utils.arrayFilter(a.markers(),function(o){return-1!==o.title.toLowerCase().indexOf(e)}):a.markers()},a),a.filteredMarkers.subscribe(function(){var o=ko.utils.compareArrays(a.markers(),a.filteredMarkers());ko.utils.arrayForEach(o,function(o){o.value.setMap("deleted"===o.status?null:e)})}),a.clickMarker=function(e){a.selectedMarker()&&a.previousMarker(a.selectedMarker()),a.selectedMarker(e)},a.selectMarker=function(e){a.clickMarker(e),google.maps.event.trigger(e,"click"),a.selectedMarker(e)},a.selectedMarker.subscribe(function(){a.selectedMarker().highlight(!0)}),a.previousMarker.subscribe(function(){a.previousMarker().highlight(!1)});{var n=function(e){for(var o=e.replace(/\D/g,""),a={0:"(",3:") ",6:" - "},r="",n=0;n<o.length;n++)r+=(a[n]||"")+o[n];return r};!function(){if("object"==typeof window.google&&"object"==typeof window.google.maps){var t={center:{lat:38.869987,lng:-77.090936},zoom:13};e=new google.maps.Map(document.getElementById("map-canvas"),t),o=new google.maps.InfoWindow({content:null});for(var l=0;l<r.length;l++){var i=new google.maps.LatLng(r[l].lat,r[l].lng),s=new google.maps.Marker({position:i,title:r[l].name,map:e,phone:r[l].phone,highlight:r[l].highlight});google.maps.event.addListener(s,"click",function(){var r=this;o.setContent(" ");var t="http://api.yelp.com/phone_search?phone="+r.phone+"&ywsid=W6XJfNlcVjV2XJhDqYdgWA",l=setTimeout(function(){o.setContent("Yelp Information failed to load")},8e3);$.ajax({url:t,dataType:"jsonp",success:function(e){var a=e.businesses[0],r=n(a.phone),t="<h4>"+a.name+"</h4><p><a href='"+a.url+"'>Yelp Rating: <img src='"+a.rating_img_url_small+"' alt='"+a.avg_rating+"'></a><br>Phone: "+r+"<br>"+a.address1+"</p>";o.setContent(t),clearTimeout(l)}}),a.clickMarker(r),e.panTo(r.position),o.open(e,r)}),google.maps.event.addListener(o,"closeclick",function(){a.selectedMarker().highlight(!1),e.panTo(i)}),a.markers.push(s)}}else $("#map-canvas").html("<h3>Google Map Failed to Load</h3>")}()}a.currentTemp=ko.observable(),a.currentCondition=ko.observable(),a.currentIcon=ko.observable(),a.currentIconURL=ko.computed(function(){return"http://openweathermap.org/img/w/"+a.currentIcon()+".png"},this);!function(){var e="http://api.openweathermap.org/data/2.5/weather?q=Washington,DC&units=imperial&APPID=115dcc40d88f4cbcdbb3bdcac6d6d62e";$.getJSON(e,function(e){a.currentTemp(e.main.temp),a.currentCondition(e.weather[0].description),a.currentIcon(e.weather[0].icon)}).fail(function(e){alert("Weather information has failed to load")})}()};ko.applyBindings(new viewModel);